<ion-header>
  <ion-toolbar color="success">
    <ion-title>{{ mealParam | titlecase }}</ion-title>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/inicio"></ion-back-button>
    </ion-buttons>
    <ion-buttons slot="end">
      <ion-button (click)="onScanBarcode()">
        <ion-icon name="scan-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Barra de bÃºsqueda -->
  <div class="search-bar-container">
    <div class="search-bar">
      <ion-searchbar
        [(ngModel)]="searchQuery"
        (ionInput)="onSearchChange()"
        placeholder="Buscar"
        mode="md"
        animated="true"
        class="product-search">
      </ion-searchbar>
      <ion-button fill="clear" class="filter-button">
        <ion-icon name="options-outline"></ion-icon>
      </ion-button>
    </div>
  </div>
  
  <!-- Segmentos de filtro -->
  <div class="segment-container">
    <ion-segment [(ngModel)]="segment" (ionChange)="onSegmentChange($event)" mode="md">
      <ion-segment-button value="todos">
        <ion-label>Todos</ion-label>
      </ion-segment-button>
      <ion-segment-button value="tuyos">
        <ion-label>Tuyos</ion-label>
      </ion-segment-button>
      <ion-segment-button value="recetas">
        <ion-label>Recetas</ion-label>
      </ion-segment-button>
    </ion-segment>
  </div>

  <!-- Lista de productos/recetas -->
  <div class="items-list" *ngIf="!loading && !error">
    <div *ngFor="let item of filteredItems" class="product-card" (click)="onSelect(item)">
      <div class="product-content">
        <div class="product-name">{{ item.nombre }}</div>
        <div class="product-brand" *ngIf="hasKey(item, 'marca') && item.marca">{{ item.marca }}</div>
        <div class="product-macros">
          <span class="calories">{{ item.calorias | number:'1.0-0' }} kcal</span>
          <span class="protein">{{ item.proteinas | number:'1.0-0' }}g</span>
          <span class="carbs">{{ item.carbohidratos | number:'1.0-0' }}g</span>
          <span class="fat">{{ item.grasas | number:'1.0-0' }}g</span>
        </div>
        <ion-icon name="chevron-forward-outline" class="chevron-icon"></ion-icon>
      </div>
    </div>

    <!-- Mensaje si no hay resultados -->
    <div class="no-results" *ngIf="filteredItems.length === 0">
      <p>No se encontraron resultados</p>
      <ion-button fill="outline" (click)="goToCreateProduct()">Crear nuevo producto</ion-button>
    </div>
  </div>

  <!-- Spinner de carga -->
  <div class="loading-container" *ngIf="loading">
    <ion-spinner name="crescent"></ion-spinner>
  </div>

  <!-- Mensaje de error -->
  <div class="error-container" *ngIf="error">
    <p>{{ error }}</p>
    <ion-button (click)="loadData()">Reintentar</ion-button>
  </div>
</ion-content>